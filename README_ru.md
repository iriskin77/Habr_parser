## Что это?

Основная идея - это создать набор парсеров, которые могут собирать новые статьи
с разных сайтов, используя API. Этот проект представляет собой API (Django REST) для парсеров, которые собирают данные (статьи) со следующих сайтов:

+ mel.fm https://mel.fm/
+ habr.com https://habr.com/ru/
+ tinkoff-journal https://journal.tinkoff.ru/


## Как это работает

#### Как работает API

Каждый парсер собирает статьи последовательно для каждой категории, которая добалвена в БД.
Например, для сайта habr.com можно добавить категории "программирование" и "математика" при помощи панели администратора Django. 
После этого парсер сначала соберет все статьи с главной страницы категории "программирование", потом все статьи с главной страницы
категории "математика", потом добавит их в БД. После этого другие сервисы могут обращаться к этим данным, используя API. Такой сервис
может использовать таймер, и парсер будет запускаться каждый 1/2/3 часа/дня/недели. Визуально это выглядит слеудющим образом:

![](https://github.com/iriskin77/Habr_parser_api/blob/master/images/dj_pars.png)

#### Как парсеры работают

Все парсеры работают почти одинаково. Парсер получает набор ссылок на категории. Например, категории "математика" или
"машинное обучение" для парсера, который парсит habr.com, или школа/образование для парсера, который парсит mel.fm.
После этого парсер последовательно обходит каждую категорию и собирает статьи. Визуально это выглядит следующим образом:

![](https://github.com/iriskin77/Habr_parser_api/blob/master/images/parser.png)

## Как этим пользоваться

Сначало необходимо добавить в БД ссылки и названия категорий, 
к которым относятся статьи, которые требуется спарсить. Для этого следует
использовать POST запрос. Это можно сделать с помощью Python или Postman:

```python
import requests

url_api: str = "http://127.0.0.1:1234/api/v1/add_mel_category"

data: dict = {"name_cat": "Воспитание", "link_cat": "https://mel.fm/vospitaniye"}

response = requests.post(url=url_api, data=data)

```

Если все прошло успешно, статус ответа будет 201, что означает, что новый объект в БД
создан.

2) После этого можно парсить статьи, которые относятся к добавленным категориям, 
с помощью следующих POST запросов.

Данные POST запросы запускают следующие парсеры:

+ api/v1/pars_habr запускает парсер для сайта habr.com
+ api/v1/pars_mel запускает парсер для сайта  mel.fm
+ api/v1/pars_tink запускает парсер для сайта tinkoff-journal

Если все прошло успешно, будет получен ответ со статусом 200, а также
id (Task_id) сформированной задачи в БД и в Celery (Task_id_celery):

```json
   {
    "Task was created": 200,
    "Task_id": 16,
    "Task_id_celery": "35c467b0-d723-4eea-868d-3e2ed700d622"
   }
```

Чтобы получить информацию о созданной задаче, можно использовать следующие 
GET запросы:

+ http://127.0.0.1:1234/api/v1/get_task_info_mel
+ http://127.0.0.1:1234/api/v1/get_task_habr_info
+ http://127.0.0.1:1234/api/v1/get_task_info_tink

Если все прошло успешно, вы получите следующий ответ:

```json
   {
    "task_id": 16,
    "celery_task_id": "35c467b0-d723-4eea-868d-3e2ed700d622",
    "task_status": "PENDING",
    "task_result": null
   }
```

Когда парсинг закончен и статьи добавлены в БД, вы можете просмотреть их, используя
следующие GET запросы:

+ http://127.0.0.1:1234/api/v1/articles_habr
+ http://127.0.0.1:1234/api/v1/articles_mel
+ http://127.0.0.1:1234/api/v1/articles_tink

Ответ:

```json
   [
    {
        "id": 1,
        "title": "Размышления о структурном программировании",
        "text": "\nИзначально я хотел назвать статью как нибудь вызывающе, например, \"Как наука может превращаться в религию\..."
        "date": "2023-12-31, 11:53",
        "link": "https://habr.com/ru/articles/784238/",
        "hub": 1,
        "author": 1
    },
    {
        "id": 2,
        "title": "Управление памятью и разделяемыми ресурсами без ошибок",
        "text": "\nМельком пробежал статью Синхронизация операций в .NET на примерах / Хабр, после чего..."
        "date": "2023-12-30, 19:17",
        "link": "https://habr.com/ru/articles/784184/",
        "hub": 1,
        "author": 1
    }
  ]
```

Кроме того, можно получить информацию об авторах статей:

 http://127.0.0.1:1234/api/v1/authors_habr
+ http://127.0.0.1:1234/api/v1/authors_mel
+ http://127.0.0.1:1234/api/v1/authors_tink

```json

  [
    {
        "id": 1,
        "author": "rsashka",
        "author_link": "https://habr.com/ru/users/rsashka/"
    },
    {
        "id": 2,
        "author": "nik_vr",
        "author_link": "https://habr.com/ru/users/nik_vr/"
    },
    {
        "id": 3,
        "author": "Litloc",
        "author_link": "https://habr.com/ru/users/Litloc/"
    },
    {
        "id": 4,
        "author": "alextretyak",
        "author_link": "https://habr.com/ru/users/alextretyak/"
    }
  ]  

```

## Как установить

1) Клонировать репозиторий
2) Использовать команду make app

После этого будет создать docker контейнер на порту

## Заметки

Возможные улучшения

+ Добавить Docker, чтобы было возможно установить проект олее простым способом. На данный момент это сделать довольно сложно... <strong>Сделано</strong>
+ Возможно разворачивание проекта на сервере...
